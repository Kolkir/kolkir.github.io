<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>False sharing</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Open Graph tags -->

            <meta property="og:type" content="article"/>
            <meta property="og:title" content="False sharing"/>
            <meta property="og:url" content="./19.html"/>
            <meta property="og:description" content="Here is "False sharing" example, you can try it in VS with enabled OpenMP flag. Also if you enable speed optimization for compiler single thread version will be faster, but you can see false sharing effect too. #include <iostream> #include <ctime> #include <omp.h> using std::cout; using std::endl ..."/>

    <!-- Bootstrap -->
        <link rel="stylesheet" href="./theme/css/bootstrap.min.css" type="text/css"/>
    <link href="./theme/css/font-awesome.min.css" rel="stylesheet">
    <link href="./theme/css/pygments.css" rel="stylesheet">
    <link rel="stylesheet" href="./theme/css/style.css" type="text/css"/>
    <!-- JavaScript plugins (requires jQuery) -->
    <script src="http://code.jquery.com/jquery.js"></script>

        <link href="./feeds\all.atom.xml" type="application/atom+xml" rel="alternate"
              title="C-Vision ATOM Feed"/>
        <link href="./feeds/all.rss.xml" type="application/atom+xml" rel="alternate"
              title="C-Vision RSS Feed"/>

</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="." class="navbar-brand">C-Vision</a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li><a href="./pages/about-me.html">About me</a></li>
                        <li><a href="./pages/camera-calibration.html">Camera calibration</a></li>
                        <li><a href="./pages/dicom-to-stl.html">DICOM to STL</a></li>
                        <li><a href="./pages/multithreadingc.html">Multithreading(C++)</a></li>
                        <li class="active">
                            <a href="./category/programming.html">Programming</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="./archives.html"><i class="icon-th-list"></i>Archives</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav>
<!-- /.navbar -->
<div class="container">
    <div class="row">
        <div class="col-lg-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="./19.html"
                       rel="bookmark"
                       title="Permalink to False sharing">
                        False sharing
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="icon-calendar"></i>Tue 23 November 2010
    </span>



<span class="label label-default">Tags</span>
	<a href="./tag/multithreading.html">Multithreading</a>
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Here is &quot;False sharing&quot; example, you can try it in VS with enabled
OpenMP flag. Also if you enable speed optimization for compiler single
thread version will be faster, but you can see false sharing effect too.</p>
<pre class="literal-block">
#include &lt;iostream&gt;
#include &lt;ctime&gt;
#include &lt;omp.h&gt;

using std::cout;
using std::endl;

const double M=8e8;

//single thread work to do
void one_thread()
{
    long int n1=1, n2=1;
    for(; n1&lt;M; n1+=n1%3);
    for(; n2&lt;M; n2+=n2%3);
    cout &lt;&lt; &quot;Sum = &quot; &lt;&lt; n1 + n2 &lt;&lt; endl;
}

//multi thread work to do
void multi_thread()
{
    struct T
    {
        long int n1;
        char chuck[64];//should be commented to see false sharing effect
        long int n2;
    } t;
    t.n1 = 1;
    t.n2 = 1;
    #pragma omp parallel num_threads(2) shared(M,t)
    {
        #pragma omp sections
        {
            #pragma omp section
            for(; t.n1&lt;M; t.n1+=t.n1%3);

            #pragma omp section
            for(; t.n2&lt;M; t.n2+=t.n2%3);
        }
    }
    cout &lt;&lt; &quot;Sum = &quot; &lt;&lt; t.n1 + t.n2 &lt;&lt; endl;
}

time_t start, end;
double diff;

int main(int argc, char* argv[])
{
    time(&amp;start);
    multi_thread();
    time(&amp;end);
    diff=difftime(end, start);
    cout&lt;&lt;diff&lt;&lt;&quot; seconds elapsed for multi thread calculation.&quot;&lt;&lt;endl;

    time(&amp;start);
    one_thread();
    time(&amp;end);
    diff=difftime(end, start);
    cout&lt;&lt;diff&lt;&lt;&quot; seconds elapsed for 1 thread calculation.&quot;&lt;&lt;endl;
    return 0;
}
</pre>

            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-lg-3 well well-sm" id="sidebar">
<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="icon-home icon-large"></i>Social</h4></li>
                    <li class="list-group-item"><a href="https://www.google.com/+KirillKolodyazhniy"><i
                            class="icon-google-plus-sign icon-large"></i>google-plus
                    </a></li>
                    <li class="list-group-item"><a href="https://github.com/Kolkir"><i
                            class="icon-github-sign icon-large"></i>github
                    </a></li>
                    <li class="list-group-item"><a href="http://ua.linkedin.com/pub/kirill-kolodyazhniy/14/969/79b/"><i
                            class="icon-linkedin-sign icon-large"></i>linkedin
                    </a></li>



            <li class="list-group-item"><a href="./tags.html"><h4><i class="icon-tags icon-large"></i>Tags</h4></a></li>
                <li class="list-group-item tag-1">
                    <a href="./tag/multithreading.html">
                        Multithreading
                    </a>
                </li>
                <li class="list-group-item tag-1">
                    <a href="./tag/c11.html">
                        C++11
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="./tag/cpptask.html">
                        CppTask
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="./tag/c.html">
                        C++
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="./tag/unittesting.html">
                        UnitTesting
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="./tag/scanner.html">
                        Scanner
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="./tag/overflow.html">
                        Overflow
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="./tag/stream.html">
                        stream
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="./tag/parsing.html">
                        parsing
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="./tag/calibration.html">
                        calibration
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="./tag/laser.html">
                        Laser
                    </a>
                </li>
        </ul>
    </section>
</aside>        </div>
    </div>
</div>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="./theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="./theme/js/respond.min.js"></script>
</body>
</html>